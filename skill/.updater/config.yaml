# Skill 自动更新配置
# 本配置文件定义了 Skill 自动更新系统的行为

update_policy:
  # 更新调度：支持 cron 表达式
  schedule: "0 2 * * 0"  # 每周日凌晨 2 点
  
  # 是否自动合并更新（不需要人工审核）
  auto_merge: true
  
  # 触发方式：cron（定时）/ manual（手动）/ both（两者都支持）
  trigger: "both"
  
  # 更新粒度：section（只更新变化的 section）/ full（完整替换）
  update_granularity: "section"

# 追踪的开源项目列表
tracked_projects:
  # Python 测试框架
  - name: pytest
    repo: "pytest-dev/pytest"
    track_releases: true
    track_prs: false
    track_commits: false
    affected_skills:
      - "testing/pytest-design"
    sections_to_update:
      - "capabilities"
      - "references"
      - "examples"
  
  # Python Web 框架
  - name: fastapi
    repo: "fastapi/fastapi"
    track_releases: true
    affected_skills:
      - "architecture/api-design"
  
  # 容器技术
  - name: docker
    repo: "docker/docker"
    track_releases: true
    affected_skills:
      - "devops/container-build"
  
  # 容器编排
  - name: kubernetes
    repo: "kubernetes/kubernetes"
    track_releases: true
    affected_skills:
      - "devops/container-build"
  
  # Python 语言
  - name: cpython
    repo: "python/cpython"
    track_releases: true
    affected_skills:
      - "devops/python-packaging"
  
  # Linux 内核（C 语言参考）
  - name: linux
    repo: "torvalds/linux"
    track_releases: false
    track_commits: true
    commit_filter: "Documentation"
    affected_skills:
      - "devops/c-build-system"
  
  # React
  - name: react
    repo: "facebook/react"
    track_releases: true
    affected_skills:
      - "frontend/react-component"
  
  # Vue
  - name: vue
    repo: "vuejs/core"
    track_releases: true
    affected_skills:
      - "frontend/vue-component"
  
  # CMake
  - name: cmake
    repo: "Kitware/CMake"
    track_releases: true
    affected_skills:
      - "devops/c-build-system"

# 更新规则
update_rules:
  # 主版本变更处理
  major_version_change:
    action: "create_pr"  # create_pr / auto_update / notify_only
    description: "主版本变更需要人工审核"
  
  # 次版本变更处理
  minor_version_change:
    action: "auto_update"
    description: "新功能，向后兼容"
  
  # 补丁版本变更处理
  patch_version_change:
    action: "auto_update"
    description: "Bug 修复"
  
  # 新最佳实践
  new_best_practice:
    action: "auto_update"
    sections: ["best_practices", "examples"]
  
  # 废弃特性
  deprecated_feature:
    action: "add_warning"
    description: "在 Skill 中添加废弃警告"

# 版本号升级规则
version_bump:
  # 更新类型到版本升级的映射
  mapping:
    breaking_change: "major"      # 破坏性变更 -> 主版本 +1
    new_feature: "minor"          # 新功能 -> 次版本 +1
    bug_fix: "patch"              # Bug 修复 -> 补丁版本 +1
    docs_update: "patch"          # 文档更新 -> 补丁版本 +1
    best_practice: "minor"        # 最佳实践更新 -> 次版本 +1

# 通知配置
notifications:
  # 更新成功通知
  on_success:
    enabled: true
    channels: ["log", "telegram", "webhook"]
  
  # 更新失败通知
  on_failure:
    enabled: true
    channels: ["log", "telegram", "email", "webhook"]
  
  # 需要人工审核时通知
  on_review_required:
    enabled: true
    channels: ["log", "telegram", "email", "webhook"]
  
  # Telegram 配置
  telegram:
    enabled: true
    bot_token: "${TELEGRAM_BOT_TOKEN}"  # 从环境变量读取
    user_id: "${TELEGRAM_USER_ID}"      # 从环境变量读取
    # 或者直接填写（不推荐用于生产环境）
    # bot_token: "5807378696:AAHDfl1nCtTkhk9bvtvog3cjwByYjgv0grE"
    # user_id: "5675490499"

# 日志配置
logging:
  level: "INFO"
  file: ".updater/logs/updater.log"
  max_size: "10MB"
  backup_count: 5
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# 缓存配置
cache:
  # 项目信息缓存时间（秒）
  project_info_ttl: 3600
  
  # Release 信息缓存时间（秒）
  release_info_ttl: 7200
  
  # 缓存目录
  directory: ".updater/cache"

# 安全配置
security:
  # GitHub API Token（用于访问仓库信息）
  github_token: "${GITHUB_TOKEN}"
  
  # 请求超时（秒）
  request_timeout: 30
  
  # 重试次数
  retry_count: 3
  
  # 重试间隔（秒）
  retry_delay: 5
